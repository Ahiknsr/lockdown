{% extends 'base.html' %}

{% block title %}Playground{% endblock %}

{% block content %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.27.4/codemirror.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.27.4/codemirror.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.27.4/mode/javascript/javascript.js"></script>

<style type="text/css">
    .CodeMirror {border-top: 5px ; border-bottom: 5px ; width: 600px;}
  </style>

    <script>
function editor(id)
{
    CodeMirror.fromTextArea(id, {
        height: "350px",
        matchBrackets: true,
        continuousScanning: 500,
        lineNumbers: true
    });
}

$(document).ready(function()
{ 

editor(document.getElementById('code'));
editor(document.getElementById('input'));
editor(document.getElementById('output'));

}) 
    </script>

<div  >

    <script>
    function runcode(){
    console.log('okay');
    var editor0 = $('.CodeMirror')[0].CodeMirror;
    var editor1 = $('.CodeMirror')[1].CodeMirror;
    var editor2 = $('.CodeMirror')[2].CodeMirror;
    code = editor0.getValue();
    //code = document.getElementsByName('code')[0].value;
    input = editor1.getValue();
    //input = document.getElementsByName('input')[0].value;
    tmp = document.getElementById("lang");
    lang= tmp.options[tmp.selectedIndex].value;
    var xmlhttp = new XMLHttpRequest();   // new HttpRequest instance 
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == XMLHttpRequest.DONE) {
            //document.getElementsByName('output')[0].value = xmlhttp.responseText;
            editor2.getDoc().setValue(xmlhttp.responseText);
        }
    }
    xmlhttp.open("POST", " {% url 'runcode' %} ");
    xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xmlhttp.send(JSON.stringify({ code: code, input: input, lang: lang }));
    }
    </script>


<div style="position:relative; margin: 100px" >
  <form method="post">
    {% csrf_token %}

    <form>
    <textarea name="code" id="code" cols="70" rows="10" ></textarea>
    </form>

    <select id="lang">
        <option value="c" selected="selected" >c</option>
        <option value="cpp"  >c++</option>
        <option value="py"  >python</option>
    </select>
    <button type="submit" onclick="runcode()">execute</button>
  </form>

</div>


<div style="position:relative; margin: 100px">

    <div >
    <form method="post">
        {% csrf_token %}
        <h2>input</h2>
        <form>
        <textarea name="input" id="input" cols="40" rows="10" ></textarea>
        </form>
    </form>
    </div>


    <div >
    <form method="post">
        {% csrf_token %}
        <h2>output</h2>
        <form>
        <textarea name="output" id="output" cols="40" rows="10" ></textarea>
        </form>
    </form>
    </div>

</div>

</div>

{% endblock %}

